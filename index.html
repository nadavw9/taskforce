<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TASKFORCE</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Courier+Prime:wght@400;700&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet"/>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
:root{
  --bg:#0a0b0d;--bg2:#111318;--bg3:#181c22;
  --amber:#f0a500;--amber2:#ffc740;
  --green:#00e5a0;--red:#ff4560;--blue:#3d9eff;
  --muted:#3a3f4a;--text:#c8cdd8;--text2:#7a8190;
  --border:#1e2330;
  --fh:'Barlow Condensed',sans-serif;
  --fm:'Courier Prime',monospace;
  --fb:'Barlow',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{background:var(--bg);color:var(--text);font-family:var(--fb)}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:52px;background:var(--bg2);border-bottom:1px solid var(--border);position:fixed;top:0;left:0;right:0;z-index:200}
.logo{font-family:var(--fh);font-weight:900;font-size:20px;letter-spacing:4px;color:var(--amber)}
.logo span{color:var(--text2);font-weight:400}
.top-stats{display:flex;gap:8px;align-items:center}
.stat-chip{background:var(--bg3);border:1px solid var(--border);padding:3px 8px;border-radius:3px;font-family:var(--fm);font-size:11px;color:var(--text2)}
.stat-chip strong{color:var(--amber)}
.pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:pulse 2s infinite;display:inline-block}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.main{position:fixed;left:0;right:0;bottom:56px;overflow-y:auto;padding:12px}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:56px;background:var(--bg2);border-top:1px solid var(--border);display:flex;z-index:200}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;border:none;background:transparent;color:var(--text2);font-family:var(--fh);font-size:10px;letter-spacing:1px;text-transform:uppercase;position:relative;transition:color .15s}
.nav-btn.active{color:var(--amber)}
.nav-btn.active::after{content:'';position:absolute;bottom:0;left:20%;right:20%;height:2px;background:var(--amber);border-radius:2px}
.nav-icon{font-size:18px;line-height:1}
.nav-badge{position:absolute;top:6px;right:calc(50% - 18px);background:var(--red);color:#fff;font-family:var(--fm);font-size:9px;padding:1px 4px;border-radius:8px;font-weight:700}
/* CARDS */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:14px 16px;margin-bottom:10px;border-left:3px solid var(--muted);animation:fadeUp .25s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.card.writing{border-left-color:var(--blue)}.card.coding{border-left-color:var(--green)}.card.research{border-left-color:var(--amber)}
.card.done{border-left-color:var(--green)}.card.preview_ready,.card.preview_flagged{border-left-color:var(--blue)}
.card.executing,.card.approved{border-left-color:var(--amber)}
.card.pre_flight{border-left-color:var(--purple,#a78bfa);background:rgba(167,139,250,.04)}
.card-meta{display:flex;align-items:center;gap:6px;margin-bottom:8px;flex-wrap:wrap}
.badge{font-family:var(--fh);font-size:10px;letter-spacing:1.5px;text-transform:uppercase;padding:2px 7px;border-radius:2px;border:1px solid currentColor}
.badge.writing{color:var(--blue)}.badge.coding{color:var(--green)}.badge.research{color:var(--amber)}
.badge.done{color:var(--green)}.badge.preview_ready{color:var(--blue)}.badge.preview_flagged{color:var(--amber)}
.badge.approved,.badge.executing{color:var(--amber)}.badge.error{color:var(--red)}
.badge.pre_flight{color:#a78bfa;border-color:#a78bfa}
.source-tag{font-family:var(--fm);font-size:10px;color:var(--text2)}
.pay{margin-left:auto;font-family:var(--fm);font-size:15px;font-weight:700;color:var(--green)}
.card-title{font-family:var(--fh);font-size:17px;font-weight:600;margin-bottom:6px;line-height:1.3}
.card-desc{font-size:12px;color:var(--text2);line-height:1.6;margin-bottom:10px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.card-desc.expanded{-webkit-line-clamp:unset}
/* AI strip */
.ai-strip{background:rgba(61,158,255,.06);border:1px solid rgba(61,158,255,.15);border-radius:4px;padding:8px 10px;margin-bottom:10px}
.ai-row{display:flex;align-items:flex-start;gap:6px;font-family:var(--fm);font-size:10px;color:var(--text2);margin-bottom:3px}
.ai-row:last-child{margin-bottom:0}
.ai-conf{font-weight:700;font-size:12px;padding:1px 6px;border-radius:2px}
.ai-conf.high{color:var(--green);border:1px solid var(--green)}.ai-conf.mid{color:var(--amber);border:1px solid var(--amber)}
/* Pre-flight panel */
.preflight-panel{background:rgba(167,139,250,.07);border:1px solid rgba(167,139,250,.3);border-radius:6px;padding:14px;margin-bottom:12px}
.preflight-title{font-family:var(--fh);font-size:12px;letter-spacing:2px;color:#a78bfa;text-transform:uppercase;margin-bottom:8px}
.preflight-understanding{font-size:13px;color:var(--text);line-height:1.6;margin-bottom:10px;padding:8px;background:rgba(0,0,0,.2);border-radius:3px}
.preflight-q{font-size:11px;color:var(--amber);padding:5px 8px;background:rgba(240,165,0,.08);border-radius:3px;margin-bottom:6px}
.notes-input{width:100%;background:var(--bg3);border:1px solid rgba(167,139,250,.4);color:var(--text);padding:8px 10px;font-family:var(--fm);font-size:12px;border-radius:3px;outline:none;resize:vertical;min-height:56px;margin-bottom:8px}
.notes-input:focus{border-color:#a78bfa}
.preflight-actions{display:flex;gap:8px}
.btn-confirm{background:#a78bfa;color:#0a0b0d;border:none;padding:9px 20px;font-family:var(--fh);font-size:13px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;border-radius:3px;flex:1}
.btn-confirm:hover{background:#c4b5fd}
/* Action buttons */
.card-actions{display:flex;gap:8px;flex-wrap:wrap}
.btn-ok{background:var(--green);color:var(--bg);border:none;padding:9px 20px;font-family:var(--fh);font-size:13px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;border-radius:3px;flex:1}
.btn-ok:hover{background:#00ffb5}
.btn-skip{background:transparent;color:var(--text2);border:1px solid var(--muted);padding:9px 16px;font-family:var(--fh);font-size:13px;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;border-radius:3px}
.btn-skip:hover{border-color:var(--red);color:var(--red)}
.btn-link{font-family:var(--fm);font-size:10px;color:var(--blue);text-decoration:none;align-self:center;margin-left:auto}
.prog-bar{height:3px;background:linear-gradient(90deg,var(--amber),transparent);background-size:200%;animation:shimmer 1.5s infinite;border-radius:2px;margin-top:10px}
@keyframes shimmer{0%{background-position:100%}100%{background-position:-100%}}
/* OUTPUT / PREVIEW BOX */
.output-box{background:var(--bg3);border:1px solid var(--border);border-radius:4px;margin-top:12px}
.output-head{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:6px}
.output-label{font-family:var(--fm);font-size:10px;color:var(--green)}
.output-label.preview{color:var(--blue)}
.output-label.flagged{color:var(--amber)}
.copy-btn{background:transparent;border:1px solid var(--muted);color:var(--text2);padding:3px 8px;font-family:var(--fm);font-size:10px;cursor:pointer;border-radius:2px}
.copy-btn:hover{border-color:var(--green);color:var(--green)}
.copy-btn.delivery{border-color:var(--amber);color:var(--amber)}
.copy-btn.delivery:hover{border-color:var(--green);color:var(--green)}
.output-body{padding:12px;font-size:12px;color:var(--text2);line-height:1.7;white-space:pre-wrap;max-height:260px;overflow-y:auto}
/* Blur overlay for preview */
.preview-wrap{position:relative}
.preview-blur{position:relative;overflow:hidden}
.preview-blur::after{content:'';position:absolute;bottom:0;left:0;right:0;height:80px;background:linear-gradient(to bottom,transparent,var(--bg3));pointer-events:none}
.preview-lock{margin:10px 12px;padding:12px;background:rgba(61,158,255,.06);border:1px solid rgba(61,158,255,.2);border-radius:4px;text-align:center}
.preview-lock-text{font-family:var(--fh);font-size:12px;letter-spacing:1.5px;color:var(--blue);text-transform:uppercase;margin-bottom:6px}
.preview-lock-sub{font-size:11px;color:var(--text2);line-height:1.5}
/* Quality badge */
.quality-badge{display:inline-flex;align-items:center;gap:4px;font-family:var(--fm);font-size:11px;padding:2px 7px;border-radius:3px;border:1px solid}
.quality-badge.excellent{color:var(--green);border-color:var(--green)}
.quality-badge.good{color:var(--blue);border-color:var(--blue)}
.quality-badge.flagged{color:var(--amber);border-color:var(--amber)}
/* Settings */
.section-head{font-family:var(--fh);font-size:11px;letter-spacing:2px;color:var(--text2);text-transform:uppercase;padding:12px 0 8px;border-bottom:1px solid var(--border);margin-bottom:10px}
.field-label{font-family:var(--fh);font-size:10px;letter-spacing:2px;color:var(--text2);text-transform:uppercase;margin-bottom:5px}
.field-input{width:100%;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:9px 12px;font-family:var(--fm);font-size:12px;border-radius:3px;outline:none;margin-bottom:4px;transition:border-color .15s}
.field-input:focus{border-color:var(--amber)}
.field-hint{font-size:11px;color:var(--muted);margin-bottom:14px;line-height:1.5}
.field-select{width:100%;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:9px 12px;font-family:var(--fm);font-size:12px;border-radius:3px;outline:none;margin-bottom:14px;appearance:none}
.save-btn{width:100%;background:var(--amber);color:var(--bg);border:none;padding:12px;font-family:var(--fh);font-size:14px;font-weight:700;letter-spacing:2px;text-transform:uppercase;cursor:pointer;border-radius:3px;margin-top:4px}
.save-btn:hover{background:var(--amber2)}
.sys-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-family:var(--fm);font-size:12px}
.sys-row:last-child{border-bottom:none}
.tab-group{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border)}
.tab-item{padding:8px 14px;font-family:var(--fh);font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .15s}
.tab-item.active{color:var(--amber);border-bottom-color:var(--amber)}
.filter-tabs{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;padding-bottom:2px}
.filter-tab{background:var(--bg3);border:1px solid var(--border);color:var(--text2);padding:6px 14px;font-family:var(--fh);font-size:11px;letter-spacing:1px;text-transform:uppercase;cursor:pointer;border-radius:3px;white-space:nowrap;flex-shrink:0}
.filter-tab.active{border-color:var(--amber);color:var(--amber);background:rgba(240,165,0,.08)}
.refresh-btn{background:var(--bg3);border:1px solid var(--border);color:var(--text2);padding:10px 14px;font-family:var(--fh);font-size:11px;letter-spacing:1px;text-transform:uppercase;cursor:pointer;border-radius:3px;width:100%;margin-bottom:10px}
.refresh-btn:hover{border-color:var(--amber);color:var(--amber)}
.refresh-btn:disabled{opacity:.5;cursor:not-allowed}
.rev-card{background:var(--bg3);border:1px solid var(--amber);border-radius:6px;padding:16px;margin-bottom:14px;display:flex;justify-content:space-between;align-items:center}
.rev-label{font-family:var(--fh);font-size:10px;letter-spacing:2px;color:var(--amber);text-transform:uppercase;margin-bottom:4px}
.rev-num{font-family:var(--fm);font-size:30px;color:var(--green);font-weight:700}
.rev-sub{font-family:var(--fm);font-size:11px;color:var(--text2)}
.loading-row{display:flex;align-items:center;gap:10px;padding:14px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;margin-bottom:10px;font-family:var(--fm);font-size:11px;color:var(--text2)}
.spinner{width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--amber);border-radius:50%;animation:spin .8s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:60px 20px;color:var(--text2)}
.empty-icon{font-size:40px;margin-bottom:12px;opacity:.4}
.empty-title{font-family:var(--fh);font-size:18px;letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;color:var(--text)}
.toast{position:fixed;bottom:68px;left:12px;right:12px;background:var(--bg3);border:1px solid var(--border);border-left:3px solid var(--green);padding:12px 14px;font-family:var(--fm);font-size:12px;border-radius:4px;z-index:999;animation:fadeUp .25s ease}
.toast.error{border-left-color:var(--red)}.toast.warn{border-left-color:var(--amber)}
.manual-wrap{background:var(--bg3);border:1px dashed var(--muted);border-radius:6px;padding:16px;margin-bottom:12px}
textarea.field-input{resize:vertical;min-height:80px}
::-webkit-scrollbar{width:3px;height:3px}::-webkit-scrollbar-thumb{background:var(--muted);border-radius:2px}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback} = React;

const store = {
  get:(k,d)=>{try{const v=localStorage.getItem(k);return v!=null?JSON.parse(v):d}catch{return d}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}}
};
function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}
function timeAgo(ts){const s=Math.floor((Date.now()/1000)-ts);if(s<60)return s+'s ago';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago'}

function makeDB(url){
  const base=url.replace(/\/$/,'');
  async function req(path,opts={}){const r=await fetch(base+path+'.json',{...opts,signal:AbortSignal.timeout(8000)});if(!r.ok)throw new Error('FB '+r.status);return r.json()}
  return{
    get:p=>req(p),
    set:(p,d)=>req(p,{method:'PUT',body:JSON.stringify(d),headers:{'Content-Type':'application/json'}}),
    patch:(p,d)=>req(p,{method:'PATCH',body:JSON.stringify(d),headers:{'Content-Type':'application/json'}}),
  }
}

// Build full delivery message with preview + payment instructions
function buildPreviewMessage(task, payment) {
  const preview = task.previewText || (task.output||'').split(' ').slice(0,200).join(' ');
  const payBlock = buildPaymentBlock(payment, task.paymentUrl);
  const wordsNote = task.previewWords ? `[Showing ${task.previewWords}]` : '[Preview â€” first ~200 words]';

  return `Hi! Here's a preview of the completed work for your request. Once payment is confirmed I'll send the full document right away.

â”â”â” PREVIEW ${wordsNote} â”â”â”

${preview}

[...full work continues â€” ${(task.output||'').split(' ').length} words total...]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

To receive the full work, please complete payment:

${payBlock}

Once I see the payment I'll reply with the complete deliverable immediately. Let me know if you have any questions!`;
}

function buildPaymentBlock(payment, invoiceUrl='') {
  if (!payment) return 'Please reply to arrange payment.';
  const method = payment.preferredMethod || 'paypal';
  const lines = [];
  if (invoiceUrl) {
    lines.push(`ğŸ“„ PayPal Invoice (click to pay securely): ${invoiceUrl}`);
    lines.push(`   Accepted: PayPal, credit card, debit card`);
  } else if (method==='paypal' && payment.paypal) {
    lines.push(`ğŸ’¸ PayPal: ${payment.paypal} (send as Friends & Family to avoid fees)`);
  } else if (method==='bit' && payment.bit) {
    lines.push(`ğŸ“± Bit: ${payment.bit}`);
  } else if (method==='wise' && payment.wise) {
    lines.push(`ğŸ’³ Wise: ${payment.wise}`);
  } else if (method==='bank' && payment.bankAccount) {
    lines.push(`ğŸ¦ Bank: ${payment.bankName||''} Branch ${payment.bankBranch||''} Account ${payment.bankAccount}`);
    if (payment.bankIBAN) lines.push(`   IBAN: ${payment.bankIBAN}`);
  } else if (payment.paypal) {
    lines.push(`ğŸ’¸ PayPal: ${payment.paypal}`);
  } else {
    lines.push(`Please reply to arrange payment.`);
  }
  return lines.join('\n');
}

function QualityBadge({score}){
  if(!score) return null;
  const cls = score>=85?'excellent':score>=75?'good':'flagged';
  return <span className={`quality-badge ${cls}`}>{score>=85?'â˜…':score>=75?'âœ“':'!'} {score}/100</span>;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PRE-FLIGHT CARD â€” shown before you approve
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PreFlightCard({task, onConfirm, onSkip}) {
  const [notes, setNotes] = useState('');
  const [expanded, setExpanded] = useState(false);

  return (
    <div className={'card '+task.type+' pre_flight'}>
      <div className="card-meta">
        <span className="badge pre_flight">ğŸ” pre-flight</span>
        <span className={'badge '+task.type}>{task.type}</span>
        <span className="source-tag">{task.source}</span>
        {task.createdAt&&<span style={{fontFamily:'var(--fm)',fontSize:10,color:'var(--muted)',marginLeft:'auto'}}>{timeAgo(task.createdAt)}</span>}
        {task.pay&&<span className="pay">{task.pay}</span>}
      </div>
      <div className="card-title">{task.title}</div>

      <div className={'card-desc'+(expanded?' expanded':'')} onClick={()=>setExpanded(v=>!v)}>
        {task.description}
        {!expanded&&task.description?.length>150&&<span style={{color:'var(--amber)'}}> tap to read more</span>}
      </div>

      <div className="preflight-panel">
        <div className="preflight-title">ğŸ¤– AI Understanding â€” Confirm Before Execution</div>
        <div className="preflight-understanding">
          "{task.aiUnderstoodAs || 'AI will complete this task as described.'}"
          <div style={{marginTop:6,display:'flex',gap:10,flexWrap:'wrap'}}>
            <span style={{fontFamily:'var(--fm)',fontSize:10,color:'var(--green)'}}>{task.aiConfidence}% confidence</span>
            <span style={{fontFamily:'var(--fm)',fontSize:10,color:'var(--text2)'}}>{task.aiStepsCount||'?'} steps Â· {task.aiComplexity||'medium'}</span>
          </div>
        </div>

        {task.clarifyingQuestions?.length > 0 && (
          <div style={{marginBottom:10}}>
            <div style={{fontFamily:'var(--fh)',fontSize:10,letterSpacing:'2px',color:'var(--amber)',textTransform:'uppercase',marginBottom:6}}>
              Questions for client (check post or DM them):
            </div>
            {task.clarifyingQuestions.map((q,i)=>(
              <div key={i} className="preflight-q">â“ {q}</div>
            ))}
          </div>
        )}

        <div style={{fontFamily:'var(--fh)',fontSize:10,letterSpacing:'2px',color:'var(--text2)',textTransform:'uppercase',marginBottom:5}}>
          Any extra specs or notes for the AI? (optional)
        </div>
        <textarea
          className="notes-input"
          placeholder={`e.g. "Make it more casual", "Focus on section 3", "Client is in the US"...`}
          value={notes}
          onChange={e=>setNotes(e.target.value)}
        />
        <div className="preflight-actions">
          <button className="btn-confirm" onClick={()=>onConfirm(task.id, notes)}>
            âœ“ LOOKS GOOD â€” EXECUTE
          </button>
          <button className="btn-skip" onClick={()=>onSkip(task.id)}>SKIP</button>
          {task.url&&<a href={task.url} target="_blank" rel="noreferrer" className="btn-link">VIEW â†—</a>}
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TASK CARD â€” for approved/executing/done
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function TaskCard({task, onSkip, onMarkPaid, payment}) {
  const [copied, setCopied] = useState('');
  const [expanded, setExpanded] = useState(false);

  const isPreviewReady = task.status==='preview_ready'||task.status==='preview_flagged';
  const isDone = task.status==='done';
  const isFlagged = task.status==='preview_flagged'||task.status==='done_flagged';

  const copyPreview = () => {
    const msg = buildPreviewMessage(task, payment);
    navigator.clipboard.writeText(msg);
    setCopied('preview'); setTimeout(()=>setCopied(''), 2000);
  };
  const copyFull = () => {
    navigator.clipboard.writeText(task.output||'');
    setCopied('full'); setTimeout(()=>setCopied(''), 2000);
  };

  return (
    <div className={'card '+task.type+' '+task.status}>
      <div className="card-meta">
        <span className={'badge '+task.type}>{task.type}</span>
        <span className={'badge '+task.status}>
          {task.status==='preview_ready'?'preview':task.status==='preview_flagged'?'âš  preview':task.status}
        </span>
        <span className="source-tag">{task.source}</span>
        {task.createdAt&&<span style={{fontFamily:'var(--fm)',fontSize:10,color:'var(--muted)',marginLeft:'auto'}}>{timeAgo(task.createdAt)}</span>}
        {task.pay&&<span className="pay">{task.pay}</span>}
      </div>

      <div className="card-title">{task.title}</div>

      <div className={'card-desc'+(expanded?' expanded':'')} onClick={()=>setExpanded(v=>!v)}>
        {task.description}
        {!expanded&&task.description?.length>150&&<span style={{color:'var(--amber)'}}> tap to read more</span>}
      </div>

      {task.clientNotes&&(
        <div style={{fontFamily:'var(--fm)',fontSize:11,color:'var(--amber)',marginBottom:8,padding:'5px 8px',background:'rgba(240,165,0,.06)',borderRadius:3}}>
          ğŸ“ Notes: {task.clientNotes}
        </div>
      )}

      {(task.status==='approved')&&(
        <div style={{fontFamily:'var(--fm)',fontSize:11,color:'var(--amber)'}}>
          â³ Queued â€” bot picks up within 15 min
          <div className="prog-bar"/>
        </div>
      )}
      {task.status==='executing'&&(
        <div style={{fontFamily:'var(--fm)',fontSize:11,color:'var(--amber)'}}>
          âš¡ 6-agent pipeline running...
          <div className="prog-bar"/>
        </div>
      )}

      {/* PREVIEW READY STATE */}
      {isPreviewReady && (
        <div className="output-box">
          <div className="output-head">
            <div style={{display:'flex',alignItems:'center',gap:8,flexWrap:'wrap'}}>
              <span className={'output-label preview'}>ğŸ‘ PREVIEW READY â€” AWAITING PAYMENT</span>
              {task.qualityScore&&<QualityBadge score={task.qualityScore}/>}
            </div>
          </div>
          {isFlagged&&task.qualityIssues?.length>0&&(
            <div style={{padding:'6px 12px',background:'rgba(240,165,0,.06)',borderBottom:'1px solid var(--border)',fontSize:11,color:'var(--amber)'}}>
              âš  {task.qualityIssues.slice(0,2).join(' Â· ')}
            </div>
          )}
          {/* Blurred preview */}
          <div className="preview-wrap">
            <div className="preview-blur">
              <div className="output-body" style={{maxHeight:120,overflow:'hidden'}}>
                {task.previewText || (task.output||'').split(' ').slice(0,200).join(' ')}
              </div>
            </div>
            <div className="preview-lock">
              <div className="preview-lock-text">ğŸ”’ {task.previewWords || 'Preview only'}</div>
              <div className="preview-lock-sub">Full work released after payment confirmed</div>
              {task.paymentUrl&&(
                <a href={task.paymentUrl} target="_blank" rel="noreferrer"
                   style={{display:'block',marginTop:8,color:'var(--blue)',fontFamily:'var(--fm)',fontSize:11,textDecoration:'underline'}}>
                  View PayPal invoice â†—
                </a>
              )}
            </div>
          </div>
          <div style={{padding:'10px 12px',borderTop:'1px solid var(--border)',display:'flex',gap:8,flexWrap:'wrap',alignItems:'center'}}>
            <button className="copy-btn delivery" onClick={copyPreview}>
              {copied==='preview'?'âœ“ COPIED!':'ğŸ“‹ COPY PREVIEW MESSAGE'}
            </button>
            {task.url&&<a href={task.url} target="_blank" rel="noreferrer" style={{fontFamily:'var(--fm)',fontSize:10,color:'var(--blue)',marginLeft:'auto'}}>Reply â†—</a>}
          </div>
        </div>
      )}

      {/* DONE STATE (payment confirmed, full work released) */}
      {isDone && task.output && (
        <div className="output-box">
          <div className="output-head">
            <div style={{display:'flex',alignItems:'center',gap:8}}>
              <span className="output-label">âœ“ PAID â€” FULL WORK</span>
              {task.qualityScore&&<QualityBadge score={task.qualityScore}/>}
            </div>
            <button className="copy-btn" onClick={copyFull}>{copied==='full'?'COPIED!':'COPY'}</button>
          </div>
          <div className="output-body">{task.output}</div>
          <div style={{padding:'10px 12px',borderTop:'1px solid var(--border)',display:'flex',gap:8,alignItems:'center'}}>
            {task.url&&<a href={task.url} target="_blank" rel="noreferrer" style={{fontFamily:'var(--fm)',fontSize:10,color:'var(--blue)'}}>Reply â†—</a>}
            {!task.paid&&<button onClick={()=>onMarkPaid(task.id)} style={{marginLeft:'auto',background:'transparent',border:'1px solid var(--green)',color:'var(--green)',padding:'4px 10px',fontFamily:'var(--fm)',fontSize:10,cursor:'pointer',borderRadius:2}}>MARK PAID ğŸ’°</button>}
            {task.paid&&<span style={{marginLeft:'auto',fontFamily:'var(--fm)',fontSize:10,color:'var(--green)'}}>ğŸ’° PAID {task.paidAmount?'â€” '+task.paidAmount:''}</span>}
          </div>
        </div>
      )}

      {task.status==='error'&&(
        <div style={{fontFamily:'var(--fm)',fontSize:11,color:'var(--red)',marginTop:6}}>
          âœ— {task.error||'Pipeline error'}
        </div>
      )}
    </div>
  );
}

// Payment block builder (settings preview)
function buildPaymentPreview(payment) {
  return buildPaymentBlock(payment, '');
}
function buildPaymentBlock(payment, invoiceUrl='') {
  if (!payment) return 'Please reply to arrange payment.';
  const method = payment.preferredMethod || 'paypal';
  const lines = [];
  if (invoiceUrl) {
    lines.push(`ğŸ“„ PayPal Invoice: ${invoiceUrl}`);
  } else if (method==='paypal' && payment.paypal) {
    lines.push(`ğŸ’¸ PayPal: ${payment.paypal} (Friends & Family)`);
  } else if (method==='bit' && payment.bit) {
    lines.push(`ğŸ“± Bit: ${payment.bit}`);
  } else if (method==='wise' && payment.wise) {
    lines.push(`ğŸ’³ Wise: ${payment.wise}`);
  } else if (method==='bank' && payment.bankAccount) {
    lines.push(`ğŸ¦ Bank: ${payment.bankName||''} ${payment.bankBranch||''} / ${payment.bankAccount}`);
  } else {
    lines.push('Please reply to arrange payment.');
  }
  return lines.join('\n');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAYMENT SETTINGS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PaymentSettings({payment, onChange, onSave}){
  return(
    <div>
      <div className="section-head">ğŸ’³ Payment Details</div>
      <p style={{fontSize:12,color:'var(--text2)',marginBottom:14,lineHeight:1.7}}>
        Enter once. Auto-included in every preview message sent to clients.
      </p>
      <div className="field-label">Preferred Method</div>
      <select className="field-select" value={payment.preferredMethod||'paypal'} onChange={e=>onChange({...payment,preferredMethod:e.target.value})}>
        <option value="paypal">PayPal (auto-invoice if API configured)</option>
        <option value="bit">Bit (×‘×™×˜)</option>
        <option value="wise">Wise</option>
        <option value="bank">Bank Transfer (Israel)</option>
      </select>
      <div className="field-label">PayPal Email</div>
      <input className="field-input" placeholder="you@example.com" value={payment.paypal||''} onChange={e=>onChange({...payment,paypal:e.target.value})}/>
      <div className="field-hint">Used as fallback if PayPal API isn't configured. Go to paypal.com/il to sign up free.</div>
      <div className="field-label">Bit Number (×‘×™×˜)</div>
      <input className="field-input" placeholder="05X-XXXXXXX" value={payment.bit||''} onChange={e=>onChange({...payment,bit:e.target.value})}/>
      <div className="field-hint">For Israeli clients</div>
      <div className="field-label">Wise Email</div>
      <input className="field-input" placeholder="@handle or email" value={payment.wise||''} onChange={e=>onChange({...payment,wise:e.target.value})}/>
      <div style={{background:'rgba(240,165,0,.06)',border:'1px solid rgba(240,165,0,.2)',borderRadius:4,padding:'10px 12px',marginBottom:14}}>
        <div style={{fontFamily:'var(--fh)',fontSize:11,letterSpacing:'2px',color:'var(--amber)',marginBottom:8,textTransform:'uppercase'}}>ğŸ¦ Israeli Bank Transfer</div>
        <input className="field-input" placeholder="Bank name (Hapoalim / Leumi...)" value={payment.bankName||''} onChange={e=>onChange({...payment,bankName:e.target.value})} style={{marginBottom:6}}/>
        <input className="field-input" placeholder="Branch number" value={payment.bankBranch||''} onChange={e=>onChange({...payment,bankBranch:e.target.value})} style={{marginBottom:6}}/>
        <input className="field-input" placeholder="Account number" value={payment.bankAccount||''} onChange={e=>onChange({...payment,bankAccount:e.target.value})} style={{marginBottom:6}}/>
        <input className="field-input" placeholder="IBAN (IL...)" value={payment.bankIBAN||''} onChange={e=>onChange({...payment,bankIBAN:e.target.value})} style={{marginBottom:0}}/>
      </div>
      <button className="save-btn" onClick={onSave}>SAVE PAYMENT INFO</button>
      <div style={{marginTop:14,padding:'10px 12px',background:'rgba(0,229,160,.04)',border:'1px solid rgba(0,229,160,.15)',borderRadius:4,fontSize:11,color:'var(--text2)',lineHeight:1.7}}>
        <span style={{color:'var(--green)',fontFamily:'var(--fh)',letterSpacing:'1px'}}>PREVIEW:</span>
        <span style={{whiteSpace:'pre-wrap',fontSize:10,marginTop:6,display:'block'}}>{buildPaymentPreview(payment)}</span>
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// B2B LEAD ENRICHMENT VIEW COMPONENT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function B2BView({leads, onApprove, onReject, onAddLead}){
  const [tab,setTab]=React.useState('review');
  const [form,setForm]=React.useState({company:'',domain:'',contact_name:'',contact_email:''});
  const [submitting,setSubmitting]=React.useState(false);
  const [expandedLead,setExpandedLead]=React.useState(null);

  const reviewLeads  = leads.filter(l=>l.status==='b2b_review');
  const approvedLeads = leads.filter(l=>l.status==='b2b_approved');
  const sentLeads    = leads.filter(l=>l.status==='b2b_sent');
  const pendingLeads = leads.filter(l=>l.status==='new'||l.status==='researching');
  const archivedLeads = leads.filter(l=>['low_score','b2b_rejected','error','b2b_no_email'].includes(l.status));

  const scoreColor=(s)=>s>=8?'var(--green)':s>=6?'var(--amber)':'var(--text3)';

  const handleAddLead=async(e)=>{
    e.preventDefault();
    if(!form.company) return;
    setSubmitting(true);
    await onAddLead(form.company, form.domain, form.contact_name, form.contact_email);
    setForm({company:'',domain:'',contact_name:'',contact_email:''});
    setSubmitting(false);
    setTab('pending');
  };

  return (
    <div>
      <div style={{marginBottom:16}}>
        <div style={{color:'var(--amber)',fontFamily:'var(--fh)',fontSize:12,letterSpacing:2,marginBottom:4}}>B2B LEAD ENRICHMENT</div>
        <div style={{color:'var(--text2)',fontSize:12}}>Gemini researches leads â†’ scores ICP fit â†’ drafts cold emails â†’ you approve â†’ bot sends</div>
        <div style={{display:'flex',gap:12,marginTop:12,flexWrap:'wrap'}}>
          {[
            {label:'ğŸ“‹ Review',count:reviewLeads.length,id:'review',color:'var(--green)'},
            {label:'â³ Pending',count:pendingLeads.length,id:'pending',color:'var(--text2)'},
            {label:'âœ‰ Approved',count:approvedLeads.length,id:'approved',color:'var(--amber)'},
            {label:'âœ… Sent',count:sentLeads.length,id:'sent',color:'var(--text2)'},
            {label:'â• Add Lead',count:null,id:'add',color:'var(--text2)'},
            {label:'ğŸ—„ Archive',count:archivedLeads.length,id:'archive',color:'var(--text3)'},
          ].map(t=>(
            <button key={t.id}
              onClick={()=>setTab(t.id)}
              style={{background:tab===t.id?'rgba(240,165,0,.12)':'var(--bg2)',
                border:'1px solid '+(tab===t.id?'var(--amber)':'var(--border)'),
                color:tab===t.id?'var(--amber)':t.color,
                padding:'6px 12px',fontSize:11,fontFamily:'var(--fh)',
                letterSpacing:1,cursor:'pointer',borderRadius:3,display:'flex',alignItems:'center',gap:6}}>
              {t.label}{t.count!=null&&<span style={{background:'var(--bg3)',padding:'1px 6px',borderRadius:10,fontSize:10}}>{t.count}</span>}
            </button>
          ))}
        </div>
      </div>

      {/* ADD LEAD FORM */}
      {tab==='add'&&(
        <div style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:20,marginBottom:12}}>
          <div style={{color:'var(--text1)',fontFamily:'var(--fh)',fontSize:11,letterSpacing:1.5,marginBottom:16}}>ADD NEW LEAD</div>
          <form onSubmit={handleAddLead}>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:12}}>
              <div>
                <div style={{color:'var(--text2)',fontSize:11,marginBottom:4}}>Company Name *</div>
                <input value={form.company} onChange={e=>setForm(p=>({...p,company:e.target.value}))}
                  placeholder="Acme Corp" required
                  style={{width:'100%',background:'var(--bg3)',border:'1px solid var(--border)',color:'var(--text1)',padding:'8px 10px',fontSize:13,borderRadius:3,boxSizing:'border-box'}}/>
              </div>
              <div>
                <div style={{color:'var(--text2)',fontSize:11,marginBottom:4}}>Domain</div>
                <input value={form.domain} onChange={e=>setForm(p=>({...p,domain:e.target.value}))}
                  placeholder="acme.com"
                  style={{width:'100%',background:'var(--bg3)',border:'1px solid var(--border)',color:'var(--text1)',padding:'8px 10px',fontSize:13,borderRadius:3,boxSizing:'border-box'}}/>
              </div>
              <div>
                <div style={{color:'var(--text2)',fontSize:11,marginBottom:4}}>Contact Name</div>
                <input value={form.contact_name} onChange={e=>setForm(p=>({...p,contact_name:e.target.value}))}
                  placeholder="Jane Smith"
                  style={{width:'100%',background:'var(--bg3)',border:'1px solid var(--border)',color:'var(--text1)',padding:'8px 10px',fontSize:13,borderRadius:3,boxSizing:'border-box'}}/>
              </div>
              <div>
                <div style={{color:'var(--text2)',fontSize:11,marginBottom:4}}>Contact Email</div>
                <input value={form.contact_email} onChange={e=>setForm(p=>({...p,contact_email:e.target.value}))}
                  placeholder="jane@acme.com" type="email"
                  style={{width:'100%',background:'var(--bg3)',border:'1px solid var(--border)',color:'var(--text1)',padding:'8px 10px',fontSize:13,borderRadius:3,boxSizing:'border-box'}}/>
              </div>
            </div>
            <button type="submit" disabled={submitting||!form.company}
              style={{background:'var(--amber)',color:'#000',border:'none',padding:'10px 24px',
                fontFamily:'var(--fh)',fontSize:11,letterSpacing:1.5,cursor:'pointer',borderRadius:3,
                opacity:submitting||!form.company?0.5:1}}>
              {submitting?'ADDING...':'ADD LEAD â†’'}
            </button>
            <div style={{color:'var(--text3)',fontSize:11,marginTop:10}}>
              Bot will research &amp; score within 15 min. Contact email needed for sending.
            </div>
          </form>
        </div>
      )}

      {/* REVIEW LEADS (b2b_review) */}
      {tab==='review'&&reviewLeads.length===0&&(
        <div style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:32,textAlign:'center',color:'var(--text3)'}}>
          <div style={{fontSize:32,marginBottom:8}}>ğŸ¢</div>
          <div style={{fontFamily:'var(--fh)',fontSize:12,letterSpacing:1}}>NO LEADS READY FOR REVIEW</div>
          <div style={{fontSize:12,marginTop:6}}>Add leads via the â• Add Lead tab. Bot processes them every 15 min.</div>
        </div>
      )}

      {tab==='review'&&reviewLeads.map(lead=>{
        const r=lead.research||{};
        const isExpanded=expandedLead===lead.id;
        return (
          <div key={lead.id} style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:16,marginBottom:12}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:12}}>
              <div>
                <div style={{color:'var(--text1)',fontSize:14,fontWeight:600}}>{lead.company}</div>
                <div style={{color:'var(--text2)',fontSize:12,marginTop:2}}>{lead.domain} {lead.contact_name&&`Â· ${lead.contact_name}`} {lead.contact_email&&`<${lead.contact_email}>`}</div>
                <div style={{color:'var(--text3)',fontSize:11,marginTop:2}}>{r.industry} Â· Est. {r.estimated_size} employees Â· Confidence: {r.research_confidence}</div>
              </div>
              <div style={{textAlign:'right'}}>
                <div style={{fontSize:24,fontWeight:700,color:scoreColor(lead.icpScore||0)}}>{lead.icpScore||0}<span style={{fontSize:12,color:'var(--text3)'}}>/10</span></div>
                <div style={{fontSize:10,color:'var(--text3)',fontFamily:'var(--fh)',letterSpacing:1}}>ICP FIT</div>
              </div>
            </div>

            <div style={{fontSize:12,color:'var(--text2)',marginBottom:10}}>{r.company_description}</div>

            {r.pain_points&&r.pain_points.length>0&&(
              <div style={{marginBottom:10}}>
                <div style={{color:'var(--text3)',fontSize:10,fontFamily:'var(--fh)',letterSpacing:1,marginBottom:4}}>PAIN POINTS</div>
                {r.pain_points.map((p,i)=><div key={i} style={{fontSize:12,color:'var(--text2)',paddingLeft:10,borderLeft:'2px solid var(--amber)'}}>Â· {p}</div>)}
              </div>
            )}

            <div style={{background:'var(--bg3)',borderRadius:4,padding:12,marginBottom:12,cursor:'pointer'}}
              onClick={()=>setExpandedLead(isExpanded?null:lead.id)}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                <div style={{color:'var(--text2)',fontSize:11,fontFamily:'var(--fh)',letterSpacing:1}}>âœ‰ EMAIL DRAFT Â· {lead.emailSubject}</div>
                <div style={{color:'var(--text3)',fontSize:11}}>{isExpanded?'â–² collapse':'â–¼ expand'}</div>
              </div>
              {isExpanded&&<pre style={{marginTop:10,fontSize:12,color:'var(--text1)',whiteSpace:'pre-wrap',fontFamily:'inherit'}}>{lead.emailDraft}</pre>}
            </div>

            <div style={{display:'flex',gap:8}}>
              <button onClick={()=>onApprove(lead.id)}
                style={{background:'var(--green)',color:'#fff',border:'none',padding:'8px 18px',
                  fontFamily:'var(--fh)',fontSize:11,letterSpacing:1,cursor:'pointer',borderRadius:3,flex:1}}>
                âœ“ APPROVE &amp; QUEUE SEND
              </button>
              <button onClick={()=>onReject(lead.id)}
                style={{background:'transparent',color:'var(--text3)',border:'1px solid var(--border)',
                  padding:'8px 14px',fontFamily:'var(--fh)',fontSize:11,letterSpacing:1,cursor:'pointer',borderRadius:3}}>
                âœ— REJECT
              </button>
            </div>
          </div>
        );
      })}

      {/* PENDING LEADS */}
      {tab==='pending'&&(
        pendingLeads.length===0
          ? <div style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:24,textAlign:'center',color:'var(--text3)',fontSize:12}}>No pending leads. Add via â• Add Lead tab.</div>
          : pendingLeads.map(lead=>(
            <div key={lead.id} style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:14,marginBottom:8,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div>
                <div style={{color:'var(--text1)',fontSize:13}}>{lead.company}</div>
                <div style={{color:'var(--text2)',fontSize:11}}>{lead.domain} {lead.contact_name&&`Â· ${lead.contact_name}`}</div>
              </div>
              <div style={{fontFamily:'var(--fh)',fontSize:10,letterSpacing:1,color:lead.status==='researching'?'var(--amber)':'var(--text3)'}}>
                {lead.status==='researching'?'âš¡ RESEARCHING...':'â³ QUEUED'}
              </div>
            </div>
          ))
      )}

      {/* APPROVED (queued to send) */}
      {tab==='approved'&&(
        approvedLeads.length===0
          ? <div style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:24,textAlign:'center',color:'var(--text3)',fontSize:12}}>No approved leads. Review drafts in the Review tab.</div>
          : approvedLeads.map(lead=>(
            <div key={lead.id} style={{background:'var(--bg2)',border:'1px solid var(--border)',borderLeft:'3px solid var(--amber)',borderRadius:6,padding:14,marginBottom:8}}>
              <div style={{display:'flex',justifyContent:'space-between'}}>
                <div>
                  <div style={{color:'var(--text1)',fontSize:13}}>{lead.company}</div>
                  <div style={{color:'var(--text2)',fontSize:11}}>{lead.contact_email||'No email set'} Â· {lead.emailSubject}</div>
                </div>
                <div style={{fontFamily:'var(--fh)',fontSize:10,letterSpacing:1,color:'var(--amber)'}}>â³ SENDING NEXT RUN</div>
              </div>
            </div>
          ))
      )}

      {/* SENT */}
      {tab==='sent'&&(
        sentLeads.length===0
          ? <div style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:24,textAlign:'center',color:'var(--text3)',fontSize:12}}>No sent emails yet.</div>
          : sentLeads.map(lead=>(
            <div key={lead.id} style={{background:'var(--bg2)',border:'1px solid var(--border)',borderLeft:'3px solid var(--green)',borderRadius:6,padding:14,marginBottom:8}}>
              <div style={{color:'var(--text1)',fontSize:13}}>{lead.company}</div>
              <div style={{color:'var(--text2)',fontSize:11}}>{lead.contact_email} Â· {lead.emailSubject}</div>
              <div style={{color:'var(--text3)',fontSize:11,marginTop:4}}>Sent {lead.sentAt?new Date(lead.sentAt).toLocaleDateString():''}</div>
            </div>
          ))
      )}

      {/* ARCHIVE */}
      {tab==='archive'&&(
        archivedLeads.length===0
          ? <div style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:24,textAlign:'center',color:'var(--text3)',fontSize:12}}>Archive is empty.</div>
          : archivedLeads.map(lead=>(
            <div key={lead.id} style={{background:'var(--bg2)',border:'1px solid var(--border)',borderRadius:6,padding:14,marginBottom:8,opacity:0.6}}>
              <div style={{display:'flex',justifyContent:'space-between'}}>
                <div>
                  <div style={{color:'var(--text1)',fontSize:13}}>{lead.company}</div>
                  <div style={{color:'var(--text2)',fontSize:11}}>{lead.domain}</div>
                </div>
                <div style={{fontFamily:'var(--fh)',fontSize:10,letterSpacing:1,color:'var(--text3)'}}>
                  {lead.status==='low_score'?`SCORE ${lead.icpScore}/10 (too low)`:lead.status.replace('b2b_','').toUpperCase()}
                </div>
              </div>
            </div>
          ))
      )}
    </div>
  );
}

// MAIN APP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App(){
  const [tasks,setTasks]=useState(()=>store.get('tf_tasks',[]));
  const [b2bLeads,setB2bLeads]=useState([]);
  const [view,setView]=useState('inbox');
  const [filter,setFilter]=useState('all');
  const [loading,setLoading]=useState(false);
  const [toast,setToast]=useState(null);
  const [settingsTab,setSettingsTab]=useState('system');
  const [config,setConfig]=useState(()=>store.get('tf_config',{firebaseUrl:'',autoRefresh:true}));
  const [tempConfig,setTempConfig]=useState(()=>store.get('tf_config',{firebaseUrl:'',autoRefresh:true}));
  const [payment,setPayment]=useState(()=>store.get('tf_payment',{preferredMethod:'paypal',paypal:'',bit:'',wise:'',bankName:'',bankBranch:'',bankAccount:'',bankIBAN:''}));
  const [tempPayment,setTempPayment]=useState(()=>store.get('tf_payment',{preferredMethod:'paypal',paypal:'',bit:'',wise:'',bankName:'',bankBranch:'',bankAccount:'',bankIBAN:''}));
  const dbRef=useRef(null);

  useEffect(()=>{dbRef.current=config.firebaseUrl?makeDB(config.firebaseUrl):null},[config.firebaseUrl]);
  useEffect(()=>{store.set('tf_tasks',tasks)},[tasks]);

  const showToast=useCallback((msg,type='success')=>{setToast({msg,type});setTimeout(()=>setToast(null),3500)},[]);

  // Poll Firebase for updates every 15s
  useEffect(()=>{
    if(!dbRef.current) return;
    const poll=setInterval(async()=>{
      try{
        const data=await dbRef.current.get('/tasks');
        if(data){
          setTasks(prev=>{
            const byId=Object.fromEntries(prev.map(t=>[t.id,t]));
            Object.entries(data).forEach(([k,v])=>{if(v&&typeof v==='object') byId[k]={...(byId[k]||{}), ...v}});
            return Object.values(byId);
          });
        }
        // Also poll B2B leads
        const b2bData=await dbRef.current.get('/b2b_leads');
        if(b2bData){
          setB2bLeads(Object.entries(b2bData).map(([id,v])=>({id,...v})));
        }
      }catch{}
    },15000);
    return()=>clearInterval(poll);
  },[config.firebaseUrl]);

  // Confirm pre-flight â€” sets status to 'approved' with optional client notes
  const confirmPreFlight = useCallback(async(taskId, notes) => {
    const task = tasks.find(t=>t.id===taskId);
    if(!task) return;
    const updated = {...task, status:'approved', approvedAt:Date.now(), clientNotes: notes || ''};
    setTasks(prev=>prev.map(t=>t.id===taskId?updated:t));
    if(dbRef.current){
      try{
        await dbRef.current.patch('/tasks/'+taskId, {status:'approved', approvedAt:Date.now(), clientNotes: notes||''});
        showToast('âœ“ Confirmed! Bot executes within 15 min');
      }catch(e){showToast('Confirmed locally â€” Firebase error','warn')}
    } else {
      showToast('âœ“ Confirmed (connect Firebase for bot)','warn');
    }
  },[tasks,showToast]);

  const skipTask = useCallback(async(taskId) => {
    setTasks(prev=>prev.map(t=>t.id===taskId?{...t,status:'skipped'}:t));
    if(dbRef.current) try{await dbRef.current.patch('/tasks/'+taskId,{status:'skipped'})}catch{}
    showToast('Skipped');
  },[]);

  // B2B: Approve lead for sending
  const approveB2bLead = useCallback(async(leadId) => {
    setB2bLeads(prev=>prev.map(l=>l.id===leadId?{...l,status:'b2b_approved'}:l));
    if(dbRef.current){
      try{
        await dbRef.current.patch('/b2b_leads/'+leadId,{status:'b2b_approved',approvedAt:Date.now()});
        showToast('âœ“ Lead approved â€” email sends on next bot run (â‰¤15 min)');
      }catch(e){showToast('Approved locally â€” Firebase sync error','warn')}
    }
  },[showToast]);

  // B2B: Reject/archive lead
  const rejectB2bLead = useCallback(async(leadId) => {
    setB2bLeads(prev=>prev.map(l=>l.id===leadId?{...l,status:'b2b_rejected'}:l));
    if(dbRef.current){
      try{await dbRef.current.patch('/b2b_leads/'+leadId,{status:'b2b_rejected'})}catch{}
    }
    showToast('Lead archived');
  },[]);

  // B2B: Add a new lead manually
  const addB2bLead = useCallback(async(company, domain, contactName, contactEmail) => {
    if(!company) return;
    const id='lead_'+Date.now();
    const lead={id, company, domain:domain||'', contact_name:contactName||'', contact_email:contactEmail||'', status:'new', addedAt:Date.now()};
    setB2bLeads(prev=>[lead,...prev]);
    if(dbRef.current){
      try{
        await dbRef.current.set('/b2b_leads/'+id, lead);
        showToast(`âœ“ Lead "${company}" added â€” bot enriches within 15 min`);
      }catch(e){showToast('Added locally â€” Firebase sync error','warn')}
    } else {
      showToast('Lead added (connect Firebase for bot processing)','warn');
    }
  },[showToast]);

  const markPaid = useCallback(async(taskId) => {
    const task = tasks.find(t=>t.id===taskId);
    if(!task) return;
    const amount = task.pay||'';
    const updated = {...task, paid:true, paidAmount:amount, paidAt:Date.now()};
    setTasks(prev=>prev.map(t=>t.id===taskId?updated:t));
    if(dbRef.current) try{await dbRef.current.patch('/tasks/'+taskId,{paid:true,paidAmount:amount,paidAt:Date.now()})}catch{}
    showToast('ğŸ’° Marked as paid!');
  },[tasks,showToast]);

  const saveSettings = () => {
    store.set('tf_config',tempConfig); setConfig(tempConfig);
    showToast('Settings saved âœ“');
  };
  const savePayment = () => {
    store.set('tf_payment',tempPayment); setPayment(tempPayment);
    showToast('Payment info saved âœ“');
  };

  // Task buckets
  const preFlight    = tasks.filter(t=>t.status==='pre_flight');
  const approved     = tasks.filter(t=>t.status==='approved');
  const executing    = tasks.filter(t=>t.status==='executing');
  const previewReady = tasks.filter(t=>t.status==='preview_ready'||t.status==='preview_flagged');
  const done         = tasks.filter(t=>t.status==='done'||t.status==='done_flagged');
  const active       = [...approved,...executing,...previewReady];

  const inboxTasks = filter==='all'?preFlight:preFlight.filter(t=>t.type===filter);
  const totalEarned = done.filter(t=>t.pay).reduce((s,t)=>s+parseFloat(t.pay.replace(/[^0-9.]/g,'')||0),0);

  return(<>
    <div className="topbar">
      <div className="logo">TASK<span>FORCE</span></div>
      <div className="top-stats">
        <span className="pulse-dot"/>
        <div className="stat-chip">âœˆ <strong>{preFlight.length}</strong></div>
        <div className="stat-chip">âš¡ <strong>{active.length}</strong></div>
        <div className="stat-chip">âœ“ <strong>{done.length}</strong></div>
      </div>
    </div>

    {!config.firebaseUrl&&(
      <div style={{position:'fixed',top:52,left:0,right:0,zIndex:190,background:'linear-gradient(90deg,#1a1200,#241900)',borderBottom:'2px solid var(--amber)',padding:'14px 16px'}}>
        <div style={{fontFamily:'var(--fh)',fontSize:14,letterSpacing:'2px',color:'var(--amber)',marginBottom:6,textTransform:'uppercase'}}>âš¡ Connect Firebase to activate bot</div>
        <input style={{width:'100%',background:'var(--bg3)',border:'1px solid var(--amber)',color:'var(--text)',padding:'8px 12px',fontFamily:'var(--fm)',fontSize:12,borderRadius:3,outline:'none',marginBottom:8}} placeholder="https://taskforce-2b7da-default-rtdb.firebaseio.com" onBlur={e=>{if(e.target.value.trim()){const nc={...config,firebaseUrl:e.target.value.trim()};store.set('tf_config',nc);setConfig(nc);setTempConfig(nc);showToast('Firebase connected âœ“')}}}/>
      </div>
    )}

    <div className="main" style={{top:config.firebaseUrl?52:142}}>

      {/* â”€â”€ INBOX (pre-flight cards) â”€â”€ */}
      {view==='inbox'&&(<>
        <div className="filter-tabs">
          {['all','writing','coding','research'].map(f=>(
            <button key={f} className={'filter-tab'+(filter===f?' active':'')} onClick={()=>setFilter(f)}>{f}</button>
          ))}
        </div>

        {inboxTasks.length===0&&(
          <div className="empty">
            <div className="empty-icon">ğŸ“­</div>
            <div className="empty-title">Inbox empty</div>
            <div style={{fontSize:13,marginTop:6,color:'var(--text2)',lineHeight:1.8}}>
              Bot runs every 15 min and sends AI-verified tasks here.<br/>
              Each card shows what the AI understood before you approve.
            </div>
          </div>
        )}
        {inboxTasks.map(t=>(
          <PreFlightCard key={t.id} task={t} onConfirm={confirmPreFlight} onSkip={skipTask}/>
        ))}
      </>)}

      {/* â”€â”€ ACTIVE (approved/executing/preview) â”€â”€ */}
      {view==='active'&&(<>
        {active.length===0?(
          <div className="empty">
            <div className="empty-icon">âš¡</div>
            <div className="empty-title">Nothing active</div>
            <div style={{fontSize:13,marginTop:6,color:'var(--text2)'}}>Confirmed tasks appear here while the pipeline runs</div>
          </div>
        ):active.map(t=><TaskCard key={t.id} task={t} onSkip={skipTask} onMarkPaid={markPaid} payment={payment}/>)}
      </>)}

      {/* â”€â”€ DONE â”€â”€ */}
      {view==='done'&&(<>
        <div className="rev-card">
          <div>
            <div className="rev-label">Estimated Revenue</div>
            <div className="rev-num">${totalEarned.toFixed(0)}</div>
            <div className="rev-sub">{done.length} task{done.length!==1?'s':''} completed</div>
          </div>
          <div style={{textAlign:'right'}}>
            <div className="rev-label">Confirmed Paid</div>
            <div style={{fontFamily:'var(--fm)',fontSize:20,color:'var(--green)',fontWeight:700,marginTop:4}}>
              ${done.filter(t=>t.paid).reduce((s,t)=>s+parseFloat((t.paidAmount||'0').replace(/[^0-9.]/g,'')||0),0).toFixed(0)}
            </div>
            <div style={{fontFamily:'var(--fm)',fontSize:11,color:'var(--text2)'}}>{done.filter(t=>t.paid).length} paid</div>
          </div>
        </div>
        {done.length===0?(
          <div className="empty">
            <div className="empty-icon">âœ…</div>
            <div className="empty-title">No completed tasks yet</div>
          </div>
        ):done.map(t=><TaskCard key={t.id} task={t} onSkip={skipTask} onMarkPaid={markPaid} payment={payment}/>)}
      </>)}


      {/* â”€â”€ B2B LEAD ENRICHMENT â”€â”€ */}
      {view==='b2b'&&(
        <div style={{paddingBottom:80}}>
          <B2BView
            leads={b2bLeads}
            onApprove={approveB2bLead}
            onReject={rejectB2bLead}
            onAddLead={addB2bLead}
          />
        </div>
      )}

      {/* â”€â”€ SETTINGS â”€â”€ */}
      {view==='settings'&&(
        <div style={{paddingBottom:20}}>
          <div className="tab-group">
            {[{id:'system',label:'System'},{id:'payment',label:'ğŸ’³ Payment'},{id:'paypal_api',label:'âš¡ PayPal API'},{id:'legal',label:'âš– Legal'}].map(t=>(
              <div key={t.id} className={'tab-item'+(settingsTab===t.id?' active':'')} onClick={()=>setSettingsTab(t.id)}>{t.label}</div>
            ))}
          </div>

          {settingsTab==='system'&&(
            <div>
              <div className="section-head">System Status</div>
              <div className="sys-row"><span>Reddit RSS</span><span style={{color:'var(--green)'}}>â— FREE / LIVE</span></div>
              <div className="sys-row"><span>Firebase DB</span><span style={{color:config.firebaseUrl?'var(--green)':'var(--red)'}}>{config.firebaseUrl?'â— CONNECTED':'â—‹ NOT SET'}</span></div>
              <div className="sys-row"><span>6-Agent pipeline</span><span style={{color:'var(--green)'}}>â— READY</span></div>
              <div className="sys-row"><span>Gemini 2.5 Flash</span><span style={{color:'var(--green)'}}>â— FREE</span></div>
              <div className="sys-row" style={{borderTop:'1px solid var(--amber)',paddingTop:10,marginTop:4}}>
                <span style={{color:'var(--amber)'}}>TOTAL MONTHLY COST</span>
                <span style={{color:'var(--green)',fontWeight:700}}>$0</span>
              </div>
              <div className="section-head" style={{marginTop:16}}>Configuration</div>
              <div className="field-label">Firebase Database URL</div>
              <input className="field-input" placeholder="https://taskforce-xxx-default-rtdb.firebaseio.com" value={tempConfig.firebaseUrl||''} onChange={e=>setTempConfig(p=>({...p,firebaseUrl:e.target.value}))}/>
              <div className="field-hint">Approvals write here, bot reads from here</div>
              <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:14}}>
                <input type="checkbox" id="auto" checked={tempConfig.autoRefresh||false} onChange={e=>setTempConfig(p=>({...p,autoRefresh:e.target.checked}))} style={{accentColor:'var(--amber)',width:16,height:16}}/>
                <label htmlFor="auto" style={{fontSize:13,color:'var(--text2)',cursor:'pointer'}}>Auto-refresh every 3 min</label>
              </div>
              <button className="save-btn" onClick={saveSettings}>SAVE SETTINGS</button>
            </div>
          )}

          {settingsTab==='payment'&&<PaymentSettings payment={tempPayment} onChange={setTempPayment} onSave={savePayment}/>}

          {settingsTab==='paypal_api'&&(
            <div>
              <div className="section-head">âš¡ PayPal Auto-Invoicing Setup</div>
              <p style={{fontSize:12,color:'var(--text2)',marginBottom:14,lineHeight:1.8}}>
                This creates a real PayPal invoice automatically for each completed task. Client receives a payment link; you get the money directly to your PayPal. Then n8n detects the payment and releases the full work automatically.
              </p>
              <div style={{background:'rgba(61,158,255,.06)',border:'1px solid rgba(61,158,255,.2)',borderRadius:4,padding:'12px',marginBottom:16}}>
                <div style={{fontFamily:'var(--fh)',fontSize:11,letterSpacing:'2px',color:'var(--blue)',textTransform:'uppercase',marginBottom:10}}>Step 1 â€” Upgrade to Business Account</div>
                <div style={{fontSize:12,color:'var(--text2)',lineHeight:1.8}}>
                  Go to <strong style={{color:'var(--text)'}}>paypal.com/il</strong> â†’ Settings â†’ Upgrade to Business (free). You keep the same email and balance.
                </div>
              </div>
              <div style={{background:'rgba(61,158,255,.06)',border:'1px solid rgba(61,158,255,.2)',borderRadius:4,padding:'12px',marginBottom:16}}>
                <div style={{fontFamily:'var(--fh)',fontSize:11,letterSpacing:'2px',color:'var(--blue)',textTransform:'uppercase',marginBottom:10}}>Step 2 â€” Get API Credentials</div>
                <div style={{fontSize:12,color:'var(--text2)',lineHeight:1.8}}>
                  1. Go to <strong style={{color:'var(--text)'}}>developer.paypal.com</strong><br/>
                  2. Log in with your PayPal account<br/>
                  3. Apps & Credentials â†’ Create App â†’ name it "taskforce"<br/>
                  4. Switch from Sandbox to <strong style={{color:'var(--amber)'}}>Live</strong><br/>
                  5. Copy <strong style={{color:'var(--text)'}}>Client ID</strong> and <strong style={{color:'var(--text)'}}>Client Secret</strong>
                </div>
              </div>
              <div style={{background:'rgba(61,158,255,.06)',border:'1px solid rgba(61,158,255,.2)',borderRadius:4,padding:'12px',marginBottom:16}}>
                <div style={{fontFamily:'var(--fh)',fontSize:11,letterSpacing:'2px',color:'var(--blue)',textTransform:'uppercase',marginBottom:10}}>Step 3 â€” Add to GitHub Secrets</div>
                <div style={{fontSize:12,color:'var(--text2)',lineHeight:1.8}}>
                  Go to your <strong style={{color:'var(--amber)'}}>private</strong> GitHub repo (taskforce-bot) â†’ Settings â†’ Secrets:<br/><br/>
                  <code style={{fontFamily:'var(--fm)',fontSize:11,background:'var(--bg)',padding:'2px 6px',borderRadius:2}}>PAYPAL_CLIENT_ID</code> â†’ paste your Client ID<br/>
                  <code style={{fontFamily:'var(--fm)',fontSize:11,background:'var(--bg)',padding:'2px 6px',borderRadius:2}}>PAYPAL_CLIENT_SECRET</code> â†’ paste your Secret<br/>
                  <code style={{fontFamily:'var(--fm)',fontSize:11,background:'var(--bg)',padding:'2px 6px',borderRadius:2}}>PAYPAL_EMAIL</code> â†’ your PayPal email<br/>
                  <code style={{fontFamily:'var(--fm)',fontSize:11,background:'var(--bg)',padding:'2px 6px',borderRadius:2}}>PAYPAL_LIVE</code> â†’ <code style={{fontFamily:'var(--fm)',fontSize:11}}>true</code>
                </div>
              </div>
              <div style={{background:'rgba(0,229,160,.05)',border:'1px solid rgba(0,229,160,.2)',borderRadius:4,padding:'12px',marginBottom:16}}>
                <div style={{fontFamily:'var(--fh)',fontSize:11,letterSpacing:'2px',color:'var(--green)',textTransform:'uppercase',marginBottom:10}}>Step 4 â€” n8n Auto-Payment Detection</div>
                <div style={{fontSize:12,color:'var(--text2)',lineHeight:1.8}}>
                  In n8n (nadav9.app.n8n.cloud):<br/>
                  1. New workflow â†’ Schedule trigger every 5 min<br/>
                  2. HTTP Request â†’ GET <code style={{fontFamily:'var(--fm)',fontSize:11}}>https://api-m.paypal.com/v2/invoicing/invoices?status=PAID</code><br/>
                  3. Credentials: OAuth2 with your Client ID + Secret<br/>
                  4. For each paid invoice â†’ Firebase PATCH â†’ <code style={{fontFamily:'var(--fm)',fontSize:11}}>/tasks/{'{'}invoiceId{'}'}</code> â†’ <code style={{fontFamily:'var(--fm)',fontSize:11}}>{'{'}status: "paid"{'}'}</code><br/>
                  5. Next bot run â†’ Release pipeline detects 'paid' â†’ sets 'done'<br/><br/>
                  <span style={{color:'var(--green)'}}>Result: client pays â†’ 5 min later â†’ full work appears in their Reddit DM automatically.</span>
                </div>
              </div>
              <div style={{fontSize:11,color:'var(--muted)',lineHeight:1.6}}>
                Note: PayPal credentials are stored only in GitHub Secrets (never visible in code or the dashboard). Even if someone reads bot.py they cannot access your PayPal.
              </div>
            </div>
          )}

          {settingsTab==='legal'&&(
            <div>
              <div className="section-head">âš– Legal Reference</div>
              <div style={{fontSize:12,color:'var(--text2)',lineHeight:2.0}}>
                <div style={{color:'var(--amber)',fontFamily:'var(--fh)',fontSize:12,letterSpacing:'1.5px',marginBottom:6,textTransform:'uppercase'}}>ğŸ‡®ğŸ‡± Must-do: Register as Atzmai</div>
                <div style={{lineHeight:1.8,marginBottom:12}}>
                  All freelance income in Israel must be declared. Under â‚ª120,000/year: register as <strong style={{color:'var(--text)'}}>Osek Patur</strong> (no VAT, file once/year). Go to your local Mas Hachnasa office. Also register with Bituach Leumi.
                </div>
                <div style={{color:'var(--amber)',fontFamily:'var(--fh)',fontSize:12,letterSpacing:'1.5px',marginBottom:6,textTransform:'uppercase'}}>ğŸ“„ AI Disclosure</div>
                <div style={{lineHeight:1.8,marginBottom:12}}>
                  No law in Israel requires it. No Reddit rule requires it. If a client asks "did you write this?" â€” answer honestly. If a post says "no AI" â€” skip it (the evaluator flags this).
                </div>
                <div style={{color:'var(--amber)',fontFamily:'var(--fh)',fontSize:12,letterSpacing:'1.5px',marginBottom:6,textTransform:'uppercase'}}>ğŸ’¸ PayPal / International Income</div>
                <div style={{lineHeight:1.8,marginBottom:12}}>
                  Report all PayPal/Wise income to Israeli Tax Authority. Exchange rate on receipt date applies. Keep records of every transaction.
                </div>
                <div style={{color:'var(--amber)',fontFamily:'var(--fh)',fontSize:12,letterSpacing:'1.5px',marginBottom:6,textTransform:'uppercase'}}>âœ… What's clean about this system</div>
                <div style={{lineHeight:1.8}}>
                  âœ“ You manually confirm every task before execution<br/>
                  âœ“ Client sees a preview before paying â€” transparent<br/>
                  âœ“ You deliver real completed work<br/>
                  âœ“ Reddit RSS reading is publicly provided by Reddit<br/>
                  âœ— Skip tasks marked "no AI" in the brief<br/>
                  âœ— Skip legal/medical advice tasks
                </div>
              </div>
              <div style={{marginTop:12,padding:'10px',background:'rgba(0,229,160,.04)',border:'1px solid rgba(0,229,160,.15)',borderRadius:4,fontSize:11,color:'var(--text2)',lineHeight:1.7}}>
                This is general info, not legal advice. For your specific situation, consult an Israeli accountant (×¨×•××” ×—×©×‘×•×Ÿ).
              </div>
            </div>
          )}
        </div>
      )}
      <div style={{height:8}}/>
    </div>

    <div className="bottom-nav">
      <button className={'nav-btn'+(view==='inbox'?' active':'')} onClick={()=>setView('inbox')}>
        {preFlight.length>0&&<span className="nav-badge">{preFlight.length}</span>}
        <span className="nav-icon">ğŸ“¥</span>INBOX
      </button>
      <button className={'nav-btn'+(view==='active'?' active':'')} onClick={()=>setView('active')}>
        {active.length>0&&<span className="nav-badge" style={{background:'var(--amber)'}}>{active.length}</span>}
        <span className="nav-icon">âš¡</span>ACTIVE
      </button>
      <button className={'nav-btn'+(view==='done'?' active':'')} onClick={()=>setView('done')}>
        <span className="nav-icon">âœ…</span>DONE
      </button>
      <button className={'nav-btn'+(view==='b2b'?' active':'')} onClick={()=>setView('b2b')}>
        {b2bLeads.filter(l=>l.status==='b2b_review').length>0&&<span className="nav-badge" style={{background:'var(--green)'}}>{b2bLeads.filter(l=>l.status==='b2b_review').length}</span>}
        <span className="nav-icon">ğŸ¢</span>B2B
      </button>
      <button className={'nav-btn'+(view==='settings'?' active':'')} onClick={()=>setView('settings')}>
        <span className="nav-icon">âš™</span>SETUP
      </button>
    </div>

    {toast&&<div className={'toast'+(toast.type==='error'?' error':toast.type==='warn'?' warn':'')}>{toast.msg}</div>}
  </>);
}

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
